<!DOCTYPE html>
<html>
<head>
    <title>Lab 5</title>
    <meta charset="utf-8" />

    <link rel="stylesheet" href="https://d19vzq90twjlae.cloudfront.net/leaflet-0.7/leaflet.css" />
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"
    />

    <link href='https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js'></script>
    <script src='https://api.mapbox.com/mapbox.js/plugins/turf/v3.0.11/turf.min.js'></script>
    <!--Add mapbox.js -->
    <script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.css' rel='stylesheet' />

    <style>
    body {
    margin: 0;
    padding: 0;
  }

  #map {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 100%;
  }
  #delete, #sim {
              position: absolute;
              top:50px;
              right:10px;
              z-index:100;
              background:white;
              color:black;
              padding:6px;
              border-radius:4px;
              font-family: 'Helvetica Neue';
              cursor: pointer;
              font-size:12px;
              text-decoration:none;
          }
  #sim {
        top:90px;
      }
    </style>
</head>
<body>

    <div id='delete'>Delete Features</div>
    <div id = 'sim'><button onclick="myFunction()">Click me</button>
    </div>
    <div id="map"></div>

    <script src="https://d19vzq90twjlae.cloudfront.net/leaflet-0.7/leaflet.js">
    </script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js">
    </script>



    <script>

    // initialize the map.

    var map = L.map('map').setView([51.0447, -114.0719], 14);
    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoieTluaW5nIiwiYSI6ImNrbGxxdXpxMzAxd3kyd21mM2JqZ3dyZGEifQ.qDVDxbn2LsePNPHw97LSTg', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 18,
        id: 'mapbox/streets-v11',
        tileSize: 512,
        zoomOffset: -1,
        accessToken: 'pk.eyJ1IjoieTluaW5nIiwiYSI6ImNrbGxxdXpxMzAxd3kyd21mM2JqZ3dyZGEifQ.qDVDxbn2LsePNPHw97LSTg'
    }).addTo(map);

//leaflet draw plug-in
		var LeafIcon = L.Icon.extend({
			options: {
				shadowUrl:
				    'http://leafletjs.com/docs/images/leaf-shadow.png',
				iconSize:     [38, 95],
				shadowSize:   [50, 64],
				iconAnchor:   [22, 94],
				shadowAnchor: [4, 62],
				popupAnchor:  [-3, -76]
			}
		});


// initialize draw tool bar.
		var drawnItems = new L.FeatureGroup();
		map.addLayer(drawnItems);

		var drawControl = new L.Control.Draw({
			position: 'topleft',
			draw: {
				polygon: {
					shapeOptions: {
						color: 'purple'
					},
					allowIntersection: false,
					drawError: {
						color: 'orange',
						timeout: 1000
					},
					showArea: true,
					metric: false,
					repeatMode: true
				},
				polyline: {
					shapeOptions: {
						color: 'red'
					},
				},
				rect: {
					shapeOptions: {
						color: 'green'
					},
				},
				circle: {
					shapeOptions: {
						color: 'steelblue'
					},
				},
				marker: false
			},
			edit: {
				featureGroup: drawnItems
			}
		});
		map.addControl(drawControl);

// Draw creattion funciton.
		map.on('draw:created', function (e) {
			var type = e.layerType,
				layer = e.layer;

			drawnItems.addLayer(layer);
      console.log(layer.toGeoJSON().geometry.coordinates);

      var data = drawnItems.toGeoJSON();
		});
    // clear polylines
    document.getElementById('delete').onclick = function(e) {
           drawnItems.clearLayers();
       }
    // click sim button and apply truf.simplify on the polyline
    function myFunction() {
    const new_data = drawnItems.toGeoJSON();
    const simplified= turf.simplify(new_data, 0.01, true);
    console.log(simplified);
    L.geoJSON(simplified).addTo(map);
  };
// Testing whether L.geoJSON works.
L.geoJSON( [-114.0545654296875, 51.04959612524969]).addTo(map);
    </script>

</body>
</html>
